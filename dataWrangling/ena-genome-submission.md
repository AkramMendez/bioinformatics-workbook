# Submission Guidelines for Chromosomal level Assemblies to ENA

This is the part 3 of the ENA data submission. Here we show how to submit the genome and connect it to your existing BioProject, BioExperiments and SRA datasets. This assumes that you have already finished the part 1 and 2 (BioProject creation and raw data submission) steps. To begin, you will need the following information:

1. Genome Assembly (scaffolds in fasta format)
2. AGP (A Golden Path) file that explains how these scaffolds should be placed and oriented to make Pseudomolecules.
3. Chromosome list file (a simple tabular file that lists the chr name specified in AGP file)
4. Manifest file, a predefined text file, with the metadata for genome submission.

All these files needs to be gzipped. For preparing manifest file, you will need the ids for BioProject/SRA etc. We will go through preparing each of these files in detail below.


## 1. Prepare your scaffolds:

The scaffold file should be in `fasta` format, and compressed (gzipped). If you have cholorplast or mitochondrial genomes in your scaffolds, it should be specified in the chromosome list file, indicating them.
It gets complicated if there are scaffolds aren't ordered or oriented, so please do not use this method if that's your case.  However, it is okay to have sequences that do not belong to any chromosomes (unplaced). It is also imprtant that the scaffolds names follow the naming convention and it matches the ids in AGP files.
Sequence names should be:
1. unique within the submission (fasta and AGP)
2. consistent between files

Here is an example scaffold file in fasta format (just one line of sequence provided for brevity)

```
>scaf_1
AACCCTAAACCCTAAACCCTAAACCCTAAACCCTAAACCCTAAACCCTAAACCCTAAACCCTAAACCCTAAACCCTAA..
>scaf_2
AAACCCTAAACCCTAAACCCTAAACCCTAAACCCTAAACCCTAAACCCTAAACCCTAAACCCTAAACCCTAAACCCTA..
>scaf_3
GACCATTTTTATGTCGCGTTCCGCCACACGTGTTTTTGTCCCCGGAGCACCTTAAAGCGGTTCTTGGCCTCCCGCGAG..
>scaf_4
TAGTAGTAGTAGTAGTAGTAGTAGTAGTAGTAGTAGTAGTAGTAGTAGTAGTAGTAGTAGTAGTAGTAGTAGTAGTAG..
>scaf_5
CCCTGACACCCGTTTTCGGAATGGGTGACGTGCTGCAACGAAATTGCACGAAACCACCCCAAACATGAGTTTTGGACC..
>scaf_6
GGATTGGGCATGTTCGTTGCGAAAAACGAAGAAATGGTTCCGGTGGCAAAAACTCGTGCTTTGTATGCACCCCGACAA..
>scaf_7
AAGTCCTTCACAAAACGGCGATAGAAGCCAGCAAGTCCTAGGAAACTCCGCACCTGTGTGATAGCCTTTGGCATAGGC..
```

## 2. Format the AGP file to match AGP requirements by ENA/NCBI

The AGP files generated by some programs will not be compatible with the ENA submission. Moreover, ENA requires you to have different names for sacaffolds that are unplaced (explained below). The format description can be found [here](https://www.ncbi.nlm.nih.gov/assembly/agp/AGP_Specification/). You can validate your AGP files with this validation [webtool](https://www.ncbi.nlm.nih.gov/projects/genome/assembly/agp/agp_validate.cgi). Since our AGP files were created with ALLMAPS, we had: 1. issue of object name (column 1) being identical to component_id (column 6). 2. for the gaps identified as `map` in AGP file failed to validate with the following error `invalid value for gap_type (column 7)` and 3. unplaced scaffolds with the orientation of `?`. To fix these issues, we can run the following script.

script `fixAGP.sh`
```bash
#!/bin/bash
agp="$1"
awk 'BEGIN{OFS=FS="\t"}$9=="?"{$9="+"}{print}' ${agp} |\
sed '/^scaf_/s/^scaf_/scaffold_/g' |\
sed '/^scaf-alt/s/^scaf-alt/scaffold-alt/g' |\
awk 'BEGIN{OFS=FS="\t"}$7=="map"{$7="scaffold"}{print}' |\
sed 's/\tyes\t/\tyes\tmap/g'
```

and run them as:

```bash
fixAGP.sh genome-allmaps.agp > genome-allmaps-fixed.agp
```
Now the new AGP file should validate without any errors. If it fails to validate, you will have to go back and fix the error before proceeding. You will not be able to submit the files without fixing errors.


## 3. Prepare Chromosome list file:

This file is most simplest (assuming you don't have organellar genomes) and easy to generate. In our case, we had 10 chromosomes, and the list file was generated as follows:

```bash
for f in {1..10}; do
  echo -e "chr$f\t$f\tChromosome";
done > chr-list.txt
```
The contents for `chr-list.txt`

```
chr1    1       Chromosome
chr2    2       Chromosome
chr3    3       Chromosome
chr4    4       Chromosome
chr5    5       Chromosome
chr6    6       Chromosome
chr7    7       Chromosome
chr8    8       Chromosome
chr9    9       Chromosome
chr10   10      Chromosome
```
